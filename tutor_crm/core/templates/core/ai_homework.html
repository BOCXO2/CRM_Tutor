{% extends "core/base.html" %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-md-10 offset-md-1">
            {% if error %}
                <div class="alert alert-danger">
                    <h4>‚ùå –û—à–∏–±–∫–∞ AI</h4>
                    <p>{{ error }}</p>
                    <a href="{% url 'ai_generate_homework' student.pk %}" class="btn btn-primary">–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞</a>
                </div>
            {% else %}
                <div class="card">
                    <div class="card-header bg-success text-white">
                        <h3>ü§ñ –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ –æ—Ç AI</h3>
                        <p class="mb-0">–£—á–µ–Ω–∏–∫: <strong>{{ student.name }}</strong> | –¢–µ–º–∞: <strong>{{ lesson_topic }}</strong></p>
                    </div>
                    <div class="card-body">
                        <div class="row mb-4">
                            <div class="col-md-8">
                                <h4 class="text-success">{{ homework.title }}</h4>
                                <p class="text-muted">{{ homework.description }}</p>
                            </div>
                            <div class="col-md-4">
                                <div class="card bg-light">
                                    <div class="card-body text-center">
                                        <h6>‚è±Ô∏è –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</h6>
                                        <p class="mb-0">{{ homework.estimated_time }}</p>
                                        <h6 class="mt-3">üìä –°–ª–æ–∂–Ω–æ—Å—Ç—å</h6>
                                        <p class="mb-0">{{ homework.difficulty }}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <h5>üìù –ó–∞–¥–∞–Ω–∏—è:</h5>
                        {% for task in homework.tasks %}
                            <div class="card mb-3">
                                <div class="card-header">
                                    <strong>–ó–∞–¥–∞–Ω–∏–µ {{ task.number }}</strong>
                                </div>
                                <div class="card-body">
                                    <p class="mb-2">{{ task.task }}</p>
                                    {% if task.hint %}
                                        <div class="alert alert-info mb-0">
                                            <strong>üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞:</strong> {{ task.hint }}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                        {% endfor %}
                        
                        <div class="d-flex justify-content-between mt-4">
                            <div>
                                <a href="{% url 'ai_generate_homework' student.pk %}" class="btn btn-secondary">
                                    üîÑ –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ
                                </a>
                                <a href="{% url 'student_detail' student.pk %}" class="btn btn-outline-secondary">
                                    ‚Üê –ù–∞–∑–∞–¥ –∫ —É—á–µ–Ω–∏–∫—É
                                </a>
                            </div>
                            <div>
                                <button class="btn btn-success" onclick="saveHomework()">
                                    üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–∫ –î–ó
                                </button>
                                <button class="btn btn-primary" onclick="printHomework()">
                                    üñ®Ô∏è –†–∞—Å–ø–µ—á–∞—Ç–∞—Ç—å –∑–∞–¥–∞–Ω–∏–µ
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            {% endif %}
        </div>
    </div>
</div>

<script>
function saveHomework() {
    const homeworkData = {
        description: "{{ homework.description }}",
        lesson_id: null // –ë—É–¥–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–Ω—è—Ç–∏—è
    };
    
    fetch("{% url 'ai_save_homework' student.pk %}", {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(homeworkData)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert('‚úÖ –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ!');
            window.location.href = "{% url 'student_detail' student.pk %}";
        } else {
            alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏: ' + data.error);
        }
    });
}

function printHomework() {
    window.print();
}
</script>

<style>
@media print {
    .btn, .d-flex {
        display: none !important;
    }
    .card {
        border: none !important;
    }
}
</style>
{% endblock %} 