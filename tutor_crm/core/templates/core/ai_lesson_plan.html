{% extends "core/base.html" %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-md-10 offset-md-1">
            {% if error %}
                <div class="alert alert-danger">
                    <h4>‚ùå –û—à–∏–±–∫–∞ AI</h4>
                    <p>{{ error }}</p>
                    <a href="{% url 'ai_plan_lesson' student.pk %}" class="btn btn-primary">–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞</a>
                </div>
            {% else %}
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h3>ü§ñ –ü–ª–∞–Ω —É—Ä–æ–∫–∞ –æ—Ç AI</h3>
                        <p class="mb-0">–£—á–µ–Ω–∏–∫: <strong>{{ student.name }}</strong> | –¢–µ–º–∞: <strong>{{ topic|default:"–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–±—Ä–∞–Ω–∞" }}</strong></p>
                    </div>
                    <div class="card-body">
                        <h4 class="text-primary">{{ plan.title }}</h4>
                        
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <h5>üéØ –¶–µ–ª–∏ —É—Ä–æ–∫–∞:</h5>
                                <ul>
                                    {% for objective in plan.objectives %}
                                        <li>{{ objective }}</li>
                                    {% endfor %}
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <h5>üìö –ú–∞—Ç–µ—Ä–∏–∞–ª—ã:</h5>
                                <ul>
                                    {% for material in plan.materials %}
                                        <li>{{ material }}</li>
                                    {% endfor %}
                                </ul>
                            </div>
                        </div>
                        
                        <h5>‚è∞ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —É—Ä–æ–∫–∞:</h5>
                        <div class="timeline">
                            {% for step in plan.structure %}
                                <div class="timeline-item mb-3">
                                    <div class="card">
                                        <div class="card-header bg-light">
                                            <strong>{{ step.time }}</strong>
                                        </div>
                                        <div class="card-body">
                                            <h6>{{ step.activity }}</h6>
                                            <p class="mb-0">{{ step.description }}</p>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                        
                        <div class="row mt-4">
                            <div class="col-md-6">
                                <h5>üìù –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ:</h5>
                                <div class="alert alert-info">
                                    {{ plan.homework }}
                                </div>
                            </div>
                            <div class="col-md-6">
                                <h5>üí° –ó–∞–º–µ—Ç–∫–∏:</h5>
                                <div class="alert alert-warning">
                                    {{ plan.notes|default:"–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç" }}
                                </div>
                            </div>
                        </div>
                        
                        <div class="d-flex justify-content-between mt-4">
                            <div>
                                <a href="{% url 'ai_plan_lesson' student.pk %}" class="btn btn-secondary">
                                    üîÑ –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –ø–ª–∞–Ω
                                </a>
                                <a href="{% url 'student_detail' student.pk %}" class="btn btn-outline-secondary">
                                    ‚Üê –ù–∞–∑–∞–¥ –∫ —É—á–µ–Ω–∏–∫—É
                                </a>
                            </div>
                            <div>
                                <button class="btn btn-success" onclick="saveLessonPlan()">
                                    üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–∫ –∑–∞–Ω—è—Ç–∏–µ
                                </button>
                                <button class="btn btn-primary" onclick="printPlan()">
                                    üñ®Ô∏è –†–∞—Å–ø–µ—á–∞—Ç–∞—Ç—å –ø–ª–∞–Ω
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            {% endif %}
        </div>
    </div>
</div>

<script>
function saveLessonPlan() {
    const planData = {
        title: "{{ plan.title }}",
        notes: "{{ plan.notes|default:'' }}",
        price: 0,
        date: new Date().toISOString().split('T')[0]
    };
    
    fetch("{% url 'ai_save_lesson_plan' student.pk %}", {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(planData)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert('‚úÖ –ü–ª–∞–Ω —É—Ä–æ–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω –∫–∞–∫ –∑–∞–Ω—è—Ç–∏–µ!');
            window.location.href = "{% url 'student_detail' student.pk %}";
        } else {
            alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏: ' + data.error);
        }
    });
}

function printPlan() {
    window.print();
}
</script>

<style>
@media print {
    .btn, .d-flex {
        display: none !important;
    }
    .card {
        border: none !important;
    }
}
</style>
{% endblock %} 